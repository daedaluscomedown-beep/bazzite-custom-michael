[customization.user]
# Make sure your user is in the 'wheel' group for sudo access
groups = ["wheel"]

[customization.kernel]
# PERFORMANCE KERNEL ARGS
# mitigations=off:   Disables Spectre/Meltdown fixes for max CPU throughput (Safe for gaming PC)
# nowatchdog:        Disables CPU watchdog to prevent micro-stutters
# amd_pstate=active: Forces the modern AMD driver for 5800X3D
append = "mitigations=off nowatchdog amd_pstate=active"

[[customization.installer.kickstart.content]]
# --- CRITICAL FIXES FOR ANACONDA ---
install  # Tells Anaconda "This is an install, not a Live session"
lang en_US.UTF-8
keyboard us
timezone America/New_York --utc
network --bootproto=dhcp --device=link --activate

# Clear the disk and set up BTRFS
zerombr
clearpart --all --initlabel --drives=nvme0n1
ignoredisk --only-use=nvme0n1

# Partition Layout (Standard Fedora Atomic)
part /boot/efi --fstype=efi --size=600 --ondisk=nvme0n1
part /boot     --fstype=ext4 --size=1024 --ondisk=nvme0n1
part btrfs.01  --fstype=btrfs --grow --ondisk=nvme0n1

# BTRFS Subvolumes (Standard Fedora Atomic Layout)
btrfs /     --subvol --name=root btrfs.01
btrfs /home --subvol --name=home btrfs.01
btrfs /var  --subvol --name=var  btrfs.01

# Bootloader (Auto allows for both UEFI and Legacy if needed, safer)
bootloader --location=auto --boot-drive=nvme0n1

# THE SOURCE IMAGE
bootc --source-imgref=ghcr.io/daedaluscomedown-beep/deconfliction:latest

# Reboot after install
reboot